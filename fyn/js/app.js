"use strict";var _createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FynViewModel(){var y=this;y.G=new G_Model;var m=y.G;y.intView=ko.observable(!1),y.title=ko.observable("FYN - Find your Neighborhood"),y.activeInterface=ko.observable(),y.error=ko.observable(!1),y.MenuVM=function(e,t){this.name=e,this.icon=t,this.alt=e+" icon",this.active=ko.observable(!1)},y.activeMenu=ko.observable("start"),y.menuRemoveActive=function(e){if(e.active())e.active(!1),y.activeMenu("start"),y.intView(!1);else{var t=!0,o=!1,r=void 0;try{for(var a,l=y.menuItems[Symbol.iterator]();!(t=(a=l.next()).done);t=!0){a.value.active(!1)}}catch(e){o=!0,r=e}finally{try{!t&&l.return&&l.return()}finally{if(o)throw r}}e.active(!0),y.intView(!0),y.activeMenu(e.name)}},this.menuItems=[new y.MenuVM("Homes","images/home.svg"),new y.MenuVM("Places","images/map.svg"),new y.MenuVM("Filters","images/shuffle.svg"),new y.MenuVM("Settings","images/cog.svg")],y.intViewClass=ko.pureComputed({read:function(){return y.activeMenu()+" "+(y.intView()?"active":"")}}),y.searchBounds="",y.User={},y.User.location={lat:null,lng:null},y.getUserLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(y.geoSetUserLocation)},y.geoSetUserLocation=function(e){y.User.location.lat=e.coords.latitude,y.User.location.lat=e.coords.lattitude},y.googleSetUserLocation=function(e){y.User.location.lat=e.geometry.location.lat(),y.User.location.lng=e.geometry.location.lng()},y.clearMarkers=function(e){var t=!0,o=!1,r=void 0;try{for(var a,l=e()[Symbol.iterator]();!(t=(a=l.next()).done);t=!0){a.value.marker.setMap(null)}}catch(e){o=!0,r=e}finally{try{!t&&l.return&&l.return()}finally{if(o)throw r}}e.removeAll()},y.hideMarkers=function(e){var t=!0,o=!1,r=void 0;try{for(var a,l=e()[Symbol.iterator]();!(t=(a=l.next()).done);t=!0){a.value.marker.setMap(null)}}catch(e){o=!0,r=e}finally{try{!t&&l.return&&l.return()}finally{if(o)throw r}}},y.showMarkers=function(e){var t=m.newBounds(),o=!0,r=!1,a=void 0;try{for(var l,s=e()[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var i=l.value;i.marker.setMap(y.G.map),t.extend(i.position)}}catch(e){r=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(r)throw a}}1==e().length?(m.map.setCenter(e()[0]?e()[0].position:m.testMarker),m.map.setZoom(e()[0]?15:12)):1<e().length&&m.map.fitBounds(t)},y.Places=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{},title:"",icon:"",iconActiveHover:"",search:"",address:"",ani:google.maps.Animation.DROP,place_id:"",saved:!1,activeSearch:!1},t=this;this.search=e.search,this.saved=ko.observable(!1),this.position=e.position,this.address=ko.observable(e.address),this.title=e.title,this.defIcon="/images/home-point.png",this.iconActiveHover="/images/home-active.png",this.mapFocused=!1,this.place_id=e.place_id,this.saved=e.saved?ko.observable(e.saved):ko.observable(!1),this.activeSearch=e.activeSearch?ko.observable(e.activeSearch):ko.observable(!1),e.icon={url:t.defIcon,size:new google.maps.Size(35,45),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,43)},this.activeIcon=ko.observable(t.defIcon),this.icon=e.icon,this.marker=y.G.createMarker(e),this.marker.addListener("mouseover",function(){t.iconSet(t.iconActiveHover),this.setIcon(t.icon)}),this.marker.addListener("mouseout",function(){t.iconSet(t.defIcon),this.setIcon(t.icon)}),this.marker.addListener("click",function(){y.G.map.panTo(t.position)})},y.Places.prototype.iconSet=function(e){this.icon.url=e,this.activeIcon(e)},y.homeSavedItems=ko.observableArray([]),y.homeActiveItems=ko.observableArray([]),y.homeItems=ko.observableArray([]),y.HomeItem=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{},title:"",icon:"",iconActiveHover:"",search:"",address:"",ani:google.maps.Animation.DROP,place_id:""};y.Places.call(this,e)},y.HomeItem.prototype=Object.create(y.Places.prototype),y.HomeItem.constructor=y.HomeItem,y.HomeItem.prototype.setHome=function(){this.saved()?(this.defIcon="/images/home-point.png",y.homeSavedItems.remove(this),"show-list"==y.hSearch.subMenu()?this.marker.setMap(null):this.marker):(this.defIcon="/images/home-saved.png",y.homeSavedItems.push(this)),this.activeIcon(this.defIcon),this.saved(!this.saved()),this.icon.url=this.icon.url==this.activeIcon?this.icon.url:this.defIcon,this.marker.setIcon(this.icon)},y.hSearch={name:ko.observable(""),search:ko.observable(""),subMenu:ko.observable("add-place"),success:ko.observable(!1),setAdd:function(){y.hideMarkers(y.homeSavedItems),y.showMarkers(y.homeActiveItems),y.hSearch.subMenu("add-place")},setList:function(){y.hideMarkers(y.homeActiveItems),y.showMarkers(y.homeSavedItems),y.hSearch.subMenu("show-list")},searchMark:function(){y.clearMarkers(y.homeActiveItems),y.G.textFindPlace({location:y.searchBounds,radius:"4000",query:""+y.hSearch.search()},y.hSearch.addMark)},checkMarkExist:function(e){y.homeActiveItems.push(e)},addMark:function(e,t){if(t==google.maps.places.PlacesServiceStatus.OK){var o=0,r=m.newBounds();y.hSearch.success(!0);var a=function(t){r.extend(t.geometry.location),setTimeout(function(){var e=new y.HomeItem({position:t.geometry.location,title:t.name,address:t.formatted_address,search:y.hSearch.search(),place_id:t.place_id});"add-place"==y.hSearch.subMenu()?e.marker.setMap(y.G.map):e.marker.setMap(null),y.hSearch.checkMarkExist(e)},(90-2*o)*o),o++},l=!0,s=!1,i=void 0;try{for(var n,c=e[Symbol.iterator]();!(l=(n=c.next()).done);l=!0){a(n.value)}}catch(e){s=!0,i=e}finally{try{!l&&c.return&&c.return()}finally{if(s)throw i}}e.length<=1?(m.map.setCenter(e[0].geometry.location),m.map.setZoom(17)):m.map.fitBounds(r)}else y.error(t)},clearSearch:function(){y.clearMarkers(y.homeActiveItems),y.hSearch.search(""),y.hSearch.success(!1)}},this.FavItem=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{},title:"",icon:"",iconActiveHover:"",search:"",address:"",ani:google.maps.Animation.DROP};y.Places.call(this,e)},y.initApp=function(){var e=m.makeLatLng("22.286394","114.149139");m.map=new google.maps.Map(m.mapEl,{center:e,zoom:12,styles:m.mStyles[0].styles,zoomControl:!1,mapTypeControl:!1,fullscreenControl:!1,streetViewControl:!0,mapTypeControlOptions:{mapTypeIds:["fyn","batman"]}}),m.map.mapTypes.set("fyn",new google.maps.StyledMapType(m.mStyles[0].styles,{name:m.mStyles[0].name,typeId:"terrain"})),m.map.mapTypes.set("batman",new google.maps.StyledMapType(m.mStyles[1].styles,{name:m.mStyles[1].name})),m.map.setMapTypeId("fyn"),m.map.mapTypeId="terrain",y.searchBounds=e},y.G.loadMap(y.G.API).then(y.initApp).catch(function(e){alert("Looks like the first URL failed. This will be due to an issue with your internet connection. You can see the response error here:\n"+e)})}var fyn=new FynViewModel;ko.applyBindings(fyn);var G_Model=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"AIzaSyAaYL795gcBKEjS2Ud2Rb12A7hebgrT-Fc",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.getElementById("map");_classCallCheck(this,o),this.API=e,this.testMarker={lat:22.2485,lng:114.1542},this.map={},this.mStyles=[{name:"FYN",styles:[{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels",stylers:[{weight:4}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels",stylers:[{weight:2}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}]},{name:"Bat Man",styles:[{featureType:"all",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels",stylers:[{visibility:"off"},{saturation:"-100"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40},{visibility:"off"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#4d6059"}]},{featureType:"landscape",elementType:"geometry.stroke",stylers:[{color:"#4d6059"}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{color:"#4d6059"}]},{featureType:"poi",elementType:"geometry",stylers:[{lightness:21}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#4d6059"}]},{featureType:"poi",elementType:"geometry.stroke",stylers:[{color:"#4d6059"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"on"},{color:"#7f8d89"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#7f8d89"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#7f8d89"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#7f8d89"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#7f8d89"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#7f8d89"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#7f8d89"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#7f8d89"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"all",stylers:[{color:"#2b3638"},{visibility:"on"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#2b3638"},{lightness:17}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#24282b"}]},{featureType:"water",elementType:"geometry.stroke",stylers:[{color:"#24282b"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.icon",stylers:[{visibility:"off"}]}]}],this.mapEl=t,this.libraries=["places","geometry"],this.Places=null}return _createClass(o,[{key:"createMarker",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{position:{},title:"",icon:"",ani:""},t={map:null};return e.position?t.position=e.position:e.position,e.title?t.title=e.title:e.position,e.icon?t.icon=e.icon:e.icon,e.ani?t.animation=e.ani:t.animation=google.maps.Animation.DROP,new google.maps.Marker(t)}},{key:"textFindPlace",value:function(e,t){var o=this;return null==o.Places&&(o.Places=new google.maps.places.PlacesService(o.map)),o.Places.textSearch(e,t)}},{key:"newBounds",value:function(){return new google.maps.LatLngBounds}},{key:"makeLatLng",value:function(e,t){return new google.maps.LatLng(e,t)}},{key:"streetViewPic",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"600x400",o=arguments[2];return"https://maps.googleapis.com/maps/api/streetview?size="+t+"&location="+e+(o=o?"&"+o+"&":"")+"&key="+this.API}},{key:"loadMap",value:function(r){var a=["places","geometry"];return new Promise(function(e,t){var o=document.createElement("script");o.src="https://maps.googleapis.com/maps/api/js?libraries="+a.join()+"&key="+r,o.onload=function(){return e()},o.onerror=function(){return t(o.src)},document.head.appendChild(o)})}}]),o}();