"use strict";function floorSelect(){return 63+83*Math.floor(3*Math.random())}function resetAllItems(){allEnemies=[],allItems=[];for(var e=0;2>e;e++)addItem("orange"),addItem("rock",e+1);addItem("heart"),player.x=202,player.y=395,player.dead=!1,player.lives=3,player.level=1,player.levelUS=200,player.score=0,player.sprite="images/char-boy.png",player.gameOver=!1,player.imgGameOver="images/game-over.png",player.imgEaten="images/eaten.png",player.imgDrown="images/drowned.png",player.playerSelect=!1}function addItem(e,t){switch(e){case"orange":allItems.push(new Item("orange"));break;case"green":allItems.push(new Item("green"));break;case"blue":allItems.push(new Item("blue"));break;case"heart":allItems.push(new Item("heart"));break;case"star":allItems.push(new Item("star"));break;case"rock":allItems.push(new Item("rock")),allItems[allItems.length-1].rockStrtLvl=4*t}}var Block=function(e,t){e?this.x=e:this.x=-101,t?this.y=t:this.y=-171};Block.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y),this.crashChk(),this.constructor===Player&&this.scoreBoard(),player.gameOver===!0?ctx.drawImage(Resources.get(player.imgGameOver),55,176):player.dead===!0&&player.y<63?ctx.drawImage(Resources.get(player.imgDrown),55,176):player.dead===!0&&player.y>62?ctx.drawImage(Resources.get(player.imgEaten),55,176):player.playerSelect&&player.plSelect()},Block.prototype.crashChk=function(){this.constructor===Enemy&&this.y==player.y&&this.x+97>player.x+16&&this.x+4<player.x+82&&!player.dead&&player.death(),this.constructor===Player&&(this.dead||this.y<62&&player.death()),this.constructor===Item&&this.y==player.y&&this.x+97>player.x+16&&this.x+4<player.x+82&&("orange"!=this.id&&"green"!=this.id&&"blue"!=this.id||(player.score+=this.score,this.show=!1,gemSound.play()),"heart"==this.id&&(player.lives++,this.show=!1,hrtSound.play()))};var Enemy=function(){this.level=player.level,this.speed=40*Math.random()+30,Math.random()<.4?this.dir=-1:this.dir=1,-1==this.dir?this.sprite="images/enemy-bug-rev.png":this.sprite="images/enemy-bug.png"};Enemy.prototype=new Block,Enemy.prototype.constructor=Enemy,Enemy.prototype.update=function(e){this.y<0&&(this.y=floorSelect()),this.move(e),this.level=player.level/1.5},Enemy.prototype.surprise=function(){player.level>5&&Math.random()<.1&&(this.y=312)},Enemy.prototype.move=function(e){-1==this.dir?(this.x<-151&&(this.x=555,this.y=floorSelect(),this.surprise()),this.x-=this.level*this.speed*e):(this.x>555&&(this.x=-151,this.y=floorSelect(),this.surprise()),this.x+=this.level*this.speed*e)};var Player=function(){this.level=1,this.levelUS=200,this.time=0,this.timeDead=0,this.lives=3,this.sprite="images/char-boy.png",this.oldSprite=this.sprite,this.dead=!1,this.score=0,this.topScore=0,this.gameOver=!1,this.playerSelect=!1,this.spriteSel="images/Selector.png",this.spriteChar0="images/char-boy.png",this.char0Score=0,this.spriteChar1="images/char-pink-girl.png",this.char1Score=600,this.spriteChar2="images/char-cat-girl.png",this.char2Score=1800,this.spriteChar3="images/char-princess-girl.png",this.char3Score=3e3,this.spriteChar4="images/char-horn-girl.png",this.char4Score=6e3};Player.prototype=new Block(202,395),Player.prototype.constructor=Player,Player.prototype.update=function(e){this.dead&&(this.sprite="images/skull-cartoon.png",this.timeDead+=e,this.timeDead>3&&this.reset()),0===this.lives&&(this.gameOver=!0,this.sprite="images/skull-cartoon.png",goSound.play()),this.score>this.topScore&&(this.topScore=this.score),this.levelUp(e)},Player.prototype.levelUp=function(e){this.score>this.levelUS&&(this.level++,this.levelUS+=this.levelUS,this.level>4&&(this.levelUS-=this.levelUS/4),this.level%2===0&&allEnemies.length<4&&allEnemies.push(new Enemy),allItems.length<10&&(Math.random()<.2?addItem("blue"):Math.random()<.4?addItem("green"):Math.random()<.7&&addItem("orange")))},Player.prototype.reset=function(){this.x=202,this.y=395,this.sprite=this.oldSprite,this.timeDead=0,this.dead=!1},Player.prototype.death=function(){this.lives--,0!==this.lives&&llSound.play(),this.dead=!0,this.playerSelect=!1},Player.prototype.handleInput=function(e){if(this.xLast=this.x,this.yLast=this.y,this.lives>0&&!this.dead)switch(e){case"left":this.x>100&&!this.playerSelect?this.x-=101:this.selX>100&&this.playerSelect&&(this.selX-=91);break;case"right":this.x<404&&!this.playerSelect?this.x+=101:this.selX<384&&this.playerSelect&&(this.selX+=91);break;case"up":this.y>62&&!this.playerSelect&&(this.y-=83);break;case"down":this.y<395&&!this.playerSelect&&(this.y+=83);break;case"p":this.playerSelect=!0,this.selX=20,this.selY=330;break;case"enter":this.playerSelect&&(20==this.selX?(this.sprite=this.spriteChar0,this.oldSprite=this.spriteChar0,this.playerSelect=!1):111==this.selX&&this.char1Score<this.topScore?(this.sprite=this.spriteChar1,this.oldSprite=this.spriteChar1,this.playerSelect=!1):202==this.selX&&this.char2Score<this.topScore?(this.sprite=this.spriteChar2,this.oldSprite=this.spriteChar2,this.playerSelect=!1):293==this.selX&&this.char3Score<this.topScore?(this.sprite=this.spriteChar3,this.oldSprite=this.spriteChar3,this.playerSelect=!1):384==this.selX&&this.char4Score<this.topScore&&(this.sprite=this.spriteChar4,this.oldSprite=this.spriteChar4,this.playerSelect=!1))}"r"==e&&resetAllItems()},Player.prototype.scoreBoard=function(){ctx.font="bold 25px Verdana",ctx.fillStyle="black",ctx.strokeStyle="white",ctx.lineWidth=1,ctx.fillText("SCORE: "+this.score,0,20),ctx.font="25px Verdana",ctx.textAlign="right",ctx.fillText(":LIVES",505,20);for(var e=0;e<this.lives;e++){if(e>=3){ctx.drawImage(Resources.get("images/scoreplus.png"),392-27*e,0);break}ctx.drawImage(Resources.get("images/scoreheart.png"),392-27*e,0)}ctx.fillText(this.level+" :LEVEL",505,45),ctx.font="bold 18px Verdana",ctx.textAlign="left",ctx.fillText("TOP-SCORE: "+this.topScore,0,45)},Player.prototype.plSelect=function(){ctx.drawImage(Resources.get("images/Player-Select.png"),16,64.5),ctx.drawImage(Resources.get(this.spriteSel),this.selX,this.selY),ctx.drawImage(Resources.get(this.sprite),101,210);for(var e=0;5>e;e++)ctx.drawImage(Resources.get(this["spriteChar"+e]),20+91*e,330),this["char"+e+"Score"]>this.topScore&&ctx.drawImage(Resources.get("images/no-select.png"),20+91*e,330)};var Item=function(e){switch(e){case"orange":this.id=e,this.score=25,this.sprite="images/Gem Orange.png",this.tTime=13,this.chance=.7,this.hTime=3;break;case"green":this.id=e,this.score=70,this.sprite="images/Gem Green.png",this.tTime=10,this.chance=.4,this.hTime=3;break;case"blue":this.id=e,this.score=150,this.sprite="images/Gem Blue.png",this.tTime=7,this.chance=.2,this.hTime=3;break;case"heart":this.id=e,this.tTime=7,this.sprite="images/Heart.png",this.chance=.1,this.hTime=10;break;case"star":this.id=e,this.sprite="images/Star.png",this.tTime=5,this.chance=.02,this.hTime=30;break;case"rock":this.id=e,this.sprite="images/Rock.png",this.tTime=20,this.chance=.8,this.hTime=2}this.show=!1,this.sTime=0,this.holdTime=0};Item.prototype=new Block,Item.prototype.constructor=Item,Item.prototype.update=function(e){!this.show&&Math.random()<this.chance&&this.holdTime>this.hTime?"rock"==this.id?player.level>=this.rockStrtLvl&&(this.show=!0,this.holdTime=0,this.move()):"heart"==this.id?player.level>=6&&(this.show=!0,this.holdTime=0,this.move()):"orange"!=this.id&&"blue"!=this.id&&"green"!=this.id||(this.show=!0,this.holdTime=0,this.move()):this.show||(this.holdTime+=e,this.x=-101,this.y=-171),this.show&&this.sTime>this.tTime?(this.show=!1,this.x=-101,this.y=-171,this.sTime=0):this.show&&(this.sTime+=e),"rock"==this.id&&this.x==player.x&&this.y+8==player.y&&(player.x=player.xLast,player.y=player.yLast)},Item.prototype.move=function(){var e=101*Math.floor(5*Math.random()),t=63;t="rock"==this.id?55+83*Math.floor(4*Math.random()):floorSelect();var s=0;return allItems.forEach(function(i){i.x!=e&&i.y!=t&&s++}),allItems.length==s?(this.x=e,void(this.y=t)):void(this.show=!1)},document.addEventListener("keydown",function(e){var t={37:"left",38:"up",39:"right",40:"down",83:"s",82:"r",80:"p",13:"enter"};player.handleInput(t[e.keyCode])});var bgMusic=document.getElementById("bckGrdMusic"),gemSound=document.getElementById("gemSound"),hrtSound=document.getElementById("hrtSound"),goSound=document.getElementById("gameOverSound"),llSound=document.getElementById("lifeLostSound"),allItems=[],allEnemies=[],player=new Player;bgMusic.play();